\documentclass[tikz,border=3pt]{standalone}
\usepackage{amsmath,amssymb}
\usepackage{xcolor}
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{matrix}
\usetikzlibrary{fit}
\usetikzlibrary{quotes}
\usetikzlibrary {backgrounds}
\usepackage{listofitems} % for \readlist to create arrays

\pgfdeclarelayer{middle}
\pgfsetlayers{background,middle, main}

\begin{document}

\definecolor{c1}{RGB}{239,243,255}
\definecolor{c2}{RGB}{198,219,239}
\definecolor{c3}{RGB}{158,202,225}
\definecolor{c4}{RGB}{107,174,214}
\definecolor{c5}{RGB}{66,146,198}
\definecolor{c6}{RGB}{33,113,181}
\definecolor{c7}{RGB}{8,69,148}

\definecolor{p1}{RGB}{254,224,210}
\definecolor{p2}{RGB}{252,146,114}
\definecolor{p3}{RGB}{222,45,38}

\definecolor{l1}{RGB}{117,107,177}

\definecolor{q1}{RGB}{242,240,247}
\definecolor{q2}{RGB}{218,218,235}
\definecolor{q3}{RGB}{188,189,220}
\definecolor{q4}{RGB}{158,154,200}
\definecolor{q5}{RGB}{117,107,177}
\definecolor{q6}{RGB}{84,39,143}


\colorlet{myred}{red!80!black}
\colorlet{myblue}{blue!80!black}
\colorlet{mygreen}{green!60!black}

\colorlet{myorange}{orange!70!red!60!black}
\colorlet{mydarkred}{red!30!black}
\colorlet{mydarkblue}{blue!40!black}
\colorlet{mydarkgreen}{green!30!black}

\begin{tikzpicture}[
	font=\scriptsize \ttfamily,
	block/.style = {rectangle, draw, text centered, rounded corners, minimum height=4em, minimum width=4em},
	connect/.style={rounded corners, black!60, text=black, thick, -{Stealth[length=5pt, width=4pt]}, shorten >=1pt, shorten <=1pt},
	input box/.style={draw=mygreen, dashed,  thick, rounded corners, inner sep=-2pt},
	output box/.style={draw=myred,  dashed, thick, rounded corners, inner sep=-2pt},
	]
	\def\boxdist{1cm}

	% input
	\begin{scope}[ yshift=1cm, local bounding box=inputbox]
		\matrix (rnaseq) [matrix of nodes, nodes in empty cells,
			column sep=-\pgflinewidth, row sep=3pt,
			nodes={thin, inner sep=0pt, outer sep=0pt, minimum width=0.6em, minimum height=0.6em, anchor=center},
			row 2/.style={nodes={fill=p1, draw=p1}},
			row 2 column 6/.style={nodes={fill=p3, draw=p3}},
			row 2 column 7/.style={nodes={fill=p3, draw=p3}},
			row 2 column 8/.style={nodes={fill=p3, draw=p3}},
			row 2 column 9/.style={nodes={fill=p3, draw=p3}},
		] {
			T & G & $\cdots$ & A & A & T & G & $\cdots$ & G \\
			0 & 0 & $\cdots$ & 0 & 0 & 1 & 1 & $\cdots$ & 1 \\
		};
		% \node (seqlabel) [rotate=270, above=1.5cm of rnaseq-1-1, yshift=1.1cm] {Seq:};
		% \node (labellabel) [rotate=270, above =1.9cm of rnaseq-2-1, yshift=0.8cm] {Label:};
		\begin{scope}[on background layer]
			\node (intputoutline) [fit=(rnaseq), input box] {};
		\end{scope}

	\end{scope}

	% token
	\begin{scope}[shift={(inputbox.south)}, yshift=-\boxdist, local bounding box=tokenbox]
		\matrix (tokens1)   [
			matrix of nodes,
			nodes in empty cells,
			nodes={fill=c2, draw=black, thin, outer sep=0pt},
			column sep=-\pgflinewidth, row sep=-\pgflinewidth,
			column 1/.style={nodes={fill=c1}},
			column 2/.style={nodes={fill=c2}},
			column 3/.style={nodes={fill=c3}},
			column 4/.style={nodes={fill=c4}},
			column 5/.style={nodes={fill=c5}},
			column 6/.style={nodes={fill=c6}},
			column 7/.style={nodes={fill=c7}},
		]
		{
			 &  &  &  &  &  & \\
		};
	\end{scope}

	% lcglm
	\begin{scope}[shift={(tokenbox.south)}, yshift=-\boxdist * 1.5, local bounding box=lcgmlbox]
		\node [block] (lcgml) {\tiny LC Pre-training GLM};
	\end{scope}

	% features
	\begin{scope}[shift={(lcgmlbox.south)},
			xshift=0.1cm,
			yshift=-\boxdist,
			local bounding box=featuresbox]
		\begin{scope}[opacity=0.7]
			\matrix (tokens1)   [
				matrix of nodes,
				nodes in empty cells,
				nodes={fill=c2, draw=black, thin, outer sep=0pt},
				column sep=-\pgflinewidth, row sep=-\pgflinewidth,
				column 1/.style={nodes={fill=c1}},
				column 2/.style={nodes={fill=c2}},
				column 3/.style={nodes={fill=c3}},
				column 4/.style={nodes={fill=c4}},
				column 5/.style={nodes={fill=c5}},
				column 6/.style={nodes={fill=c6}},
				column 7/.style={nodes={fill=c7}},
			]
			{
				 &  &  &  &  &  & \\
			};
		\end{scope}

		\begin{scope}[shift={(-0.1, -0.1)}, opacity=0.8]
			\matrix (tokens1)   [
				matrix of nodes,
				nodes in empty cells,
				nodes={fill=c2, draw=black, thin, outer sep=0pt},
				column sep=-\pgflinewidth, row sep=-\pgflinewidth,
				column 1/.style={nodes={fill=c1}},
				column 2/.style={nodes={fill=c2}},
				column 3/.style={nodes={fill=c3}},
				column 4/.style={nodes={fill=c4}},
				column 5/.style={nodes={fill=c5}},
				column 6/.style={nodes={fill=c6}},
				column 7/.style={nodes={fill=c7}},
			]
			{
				 &  &  &  &  &  & \\
			};
		\end{scope}

		\begin{scope}[shift={(-0.2, -0.2)}, opacity=1]
			\matrix (tokens1)   [
				matrix of nodes,
				nodes in empty cells,
				nodes={fill=c2, draw=black, thin, outer sep=0pt},
				column sep=-\pgflinewidth, row sep=-\pgflinewidth,
				column 1/.style={nodes={fill=c1}},
				column 2/.style={nodes={fill=c2}},
				column 3/.style={nodes={fill=c3}},
				column 4/.style={nodes={fill=c4}},
				column 5/.style={nodes={fill=c5}},
				column 6/.style={nodes={fill=c6}},
				column 7/.style={nodes={fill=c7}},
			]
			{
				 &  &  &  &  &  & \\
			};
		\end{scope}
	\end{scope}

	% qual Block
	\begin{scope}[shift={(featuresbox.east)}, xshift=\boxdist * 2, local bounding box=qualblockbox]
		\node [block] (qualblock) {Quality Block};
	\end{scope}


	% qual 
	\begin{scope}[shift={(qualblockbox.north)},  yshift=\boxdist, local bounding box=qualbox]
		\matrix (qualtoken)   [
			matrix of nodes,
			nodes in empty cells,
			nodes={draw=black, thin, outer sep=0pt},
			column sep=-\pgflinewidth, row sep=-\pgflinewidth,
			column 1/.style={nodes={fill=q6}},
			column 2/.style={nodes={fill=q5}},
			column 3/.style={nodes={fill=q4}},
			column 4/.style={nodes={fill=q3}},
			column 5/.style={nodes={fill=q2}},
			column 6/.style={nodes={fill=q1}},
		]
		{
			 &  &  &  &  &  & \\
		};

	\end{scope}

	% qual seq
	\begin{scope}[shift={(qualbox.north)}, yshift=\boxdist, local bounding box=qualseqbox]
		\matrix (qualseqmatrix) [
			matrix of nodes,
			nodes in empty cells,
			column sep=-\pgflinewidth, row sep=3pt,
			nodes={thin, inner sep=0pt, outer sep=0pt, minimum width=0.6em, minimum height=0.6em, anchor=center},
			row 2/.style={nodes={fill=p1, draw=p1}},
			row 2 column 7/.style={nodes={fill=p3, draw=p3}},
			row 2 column 8/.style={nodes={fill=p3, draw=p3}},
			row 2 column 9/.style={nodes={fill=p3, draw=p3}},
			row 2 column 10/.style={nodes={fill=p3, draw=p3}},
		] {
			G & T & G & $\cdots$ & A & A & T & G & $\cdots$ & G \\
		};

		\begin{scope}[on background layer]
			\node (qualseqoutline) [fit=(qualseqmatrix), input box] {};
		\end{scope}
	\end{scope}


	% mlp
	\begin{scope}[shift={(qualbox.east)}, xshift=\boxdist, yshift=-\boxdist,
		>=latex, % for default LaTeX arrow head
		node/.style={thick,circle,draw=myblue,minimum size=22,inner sep=0.5,outer sep=0.6},
		node in/.style={node,green!20!black,draw=mygreen!30!black,fill=mygreen!25},
		node hidden/.style={node,blue!20!black,draw=myblue!30!black,fill=myblue!20},
		node convol/.style={node,orange!20!black,draw=myorange!30!black,fill=myorange!20},
		node out/.style={node,red!20!black,draw=myred!30!black,fill=myred!20},
		connect/.style={thick,mydarkblue}, %,line cap=round
		connect arrow/.style={-{Latex[length=2,width=1.5]},line width=0.6pt,mydarkblue,shorten <=0.5,shorten >=1},
		node 1/.style={node hidden},
		node 2/.style={node hidden},
		node 3/.style={node out},
		rotate=90,
		scale=0.35,
		x=2.2cm,y=1.4cm,
		transform shape,
		local bounding box=mlpbox]
		\def\nstyle{int(\lay<\Nnodlen?min(2,\lay):3)} % map layer number onto 1, 2, or 3

		\readlist\Nnod{3,4,2} % number of nodes per layer

		\message{^^J  Layer}
		\foreachitem \N \in \Nnod{ % loop over layers
			\edef\lay{\Ncnt} % alias of index of current layer
			\message{\lay,}
			\pgfmathsetmacro\prev{int(\Ncnt-1)} % number of previous layer
			\foreach \i [evaluate={\y=\N/2-\i; \x=\lay; \n=\nstyle;}] in {1,...,\N}{ % loop over nodes
					% NODES
					\node[node \n] (N\lay-\i) at (\x,\y) {};
					%\node[circle,inner sep=2] (N\lay-\i') at (\x-0.15,\y) {}; % shifted node
					%\draw[node] (N\lay-\i) circle (\R);

					% CONNECTIONS
					\ifnum\lay>1 % connect to previous layer
						\foreach \j in {1,...,\Nnod[\prev]}{ % loop over nodes in previous layer
								\draw[connect arrow] (N\prev-\j) -- (N\lay-\i); % connect arrows directly
								%\draw[connect arrow] (N\prev-\j) -- (N\lay-\i'); % connect arrows to shifted node
							}
					\fi % else: nothing to connect first layer
				}
		}
	\end{scope}

	%  output
	\begin{scope}[shift={(mlpbox.north)}, yshift=\boxdist, local bounding box=outputbox]
		\matrix (outputmatrix) [matrix of nodes, nodes in empty cells,
			column sep=-\pgflinewidth, row sep=-\pgflinewidth,
			nodes={fill=c2, draw=black, thin, outer sep=0pt},
			row 1/.style={nodes={fill=p1}},
			row 1 column 4/.style={nodes={fill=p3}},
			row 1 column 5/.style={nodes={fill=p3}},
			row 1 column 6/.style={nodes={fill=p3}},
			row 1 column 7/.style={nodes={fill=p3}},
		] {
			 &  &  &  &  &  & \\
		};
	\end{scope}

	% predict
	\begin{scope}[shift={(outputbox.north)}, yshift=\boxdist, local bounding box=predictbox]
		\matrix (predictseq) [matrix of nodes,
			nodes in empty cells,
			column sep=-\pgflinewidth, row sep=3pt,
			nodes={thin, inner sep=0pt, outer sep=0pt, minimum width=0.6em, minimum height=0.6em, anchor=center},
			row 1 column 6/.style={nodes={fill=p3, draw=p3}},
			row 1 column 7/.style={nodes={fill=p3, draw=p3}},
			row 1 column 8/.style={nodes={fill=p3, draw=p3}},
			row 1 column 9/.style={nodes={fill=p3, draw=p3}},
		] {
			T & G & $\cdots$ & A & A & T & G & $\cdots$ & G \\
		};
		\node (predictoutline) [fit=(predictseq), output box] {};
	\end{scope}


	\path [connect]
	(inputbox)  edge ["Tokenization", font=\tiny \ttfamily] (tokenbox)
	(tokenbox) edge (lcgmlbox)
	(lcgmlbox) edge (featuresbox)
	(featuresbox) edge (qualblockbox)
	(qualbox) edge (qualblockbox)
	(mlpbox) edge (outputbox)
	(qualseqbox) edge (qualbox)
	% (outputmatrix-1-1)  edge["Loss", sloped, font=\tiny \ttfamily] (rnaseq-1-8)
	;

	\draw [connect] (outputbox) -- node[right, font=\tiny \ttfamily]{Predict} (predictbox) ;

	\draw [connect] (qualblockbox) -| (mlpbox);
\end{tikzpicture}


\end{document}
